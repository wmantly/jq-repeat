/*! jq-repeat - MIT License - https://github.com/wmantly/jq-repeat */
!function(){"use strict";class e{constructor(e){this.__callbacks=[];for(let t of Array.isArray(e)?e:[e])this.push(t)}push(e){e instanceof Function&&this.__callbacks.push(e)}call(){let e=arguments;this.__callbacks.forEach(t=>{t(...e)})}}!function(t,s){const r={};function i(e){r[e]&&null!==r[e].args?(r[e].callBack(...r[e].args),r[e].args=null,setTimeout(i,r[e].minDelay,e)):delete r[e]}const n={};function a(e){if(!e||!e.length)return;e.find("[jq-repeat-scope]").each(function(){const e=t(this).attr("jq-repeat-scope");if(e&&t.scope[e]){const s=t.scope[e];for(let e=0;e<s.length;e++)s[e]&&s[e].__jq_$el&&s.__take(s[e].__jq_$el,s[e],s);s.length=0,delete t.scope[e]}})}Object.defineProperty(n,"onNew",{value:new e,writable:!0,enumerable:!1,configurable:!0}),t.scope=new Proxy(n,{get(e,t){return e[t]||(e[t]=[]),Reflect.get(...arguments)},set(e,t,s){return Reflect.set(...arguments)}});class l extends Array{static get[Symbol.species](){return Array}constructor(e,r,i,n,a,l,h,o){super(),this.__jqRepeatId=r,this.options=i,i&&void 0!==i.indexKey&&(this.__jqIndexKey=i.indexKey),i&&void 0!==i.orderBy?(this.__jqOrderBy=i.orderBy,this.__jqOrderReverse="true"===i.orderReverse):(this.__jqOrderBy=null,this.__jqOrderReverse=!1),this._parentData=n,this.__jqParent=a,this.__jqParentIndex=l,this.__jqTemplate=h,this.nestedTemplates=o,this.$this=t(`<script type="x-tmpl-mustache" id="jq-repeat-holder-${this.__jqRepeatId}"><\/script>`),t(e).replaceWith(this.$this);let _=s.parse(this.__jqTemplate);this.templateKeys=[];for(let e of _)["name","#","^"].includes(e[0])&&this.templateKeys.push(e[1]);this.templateKeysObj=this.__parseTemplateKeys(_),this.parseKeys={};for(let e of["put","take","putUpdate","parseData"])Object.defineProperty(this,e,{enumerable:!1,get(){return this[`__${e}`]},set(t){"function"==typeof t?this[`__${e}`]=t:console.warn(`jq-repeat: Attempted to set '${e}' to a non-function value for scope '${this.__jqRepeatId}'.`)}})}__parseTemplateKeys(e){const t={};return e.forEach(e=>{const s=e[0],r=e[1];if(["name","#","^",">","&"].includes(s)){const i=r.split(".");let n=t;i.forEach((t,r)=>{const a=t.split("[")[0];r===i.length-1?n[a]="#"===s||"^"===s?this.__parseTemplateKeys(e[4]):null:(n[a]&&"object"==typeof n[a]||(n[a]={}),n=n[a])})}}),t}__compareItems(e,t){if(!this.__jqOrderBy)return 0;if(null==t)return 0;const s=e[this.__jqOrderBy],r=t[this.__jqOrderBy];if(null==s)return null==r?0:this.__jqOrderReverse?-1:1;if(null==r)return this.__jqOrderReverse?1:-1;let i=0;return i="number"==typeof s&&"number"==typeof r?s-r:"string"==typeof s&&"string"==typeof r?s.localeCompare(r,void 0,{sensitivity:"base"}):s instanceof Date&&r instanceof Date?s.getTime()-r.getTime():String(s).localeCompare(String(r),void 0,{sensitivity:"base"}),this.__jqOrderReverse?-i:i}__findInsertionIndex(e){if(!this.__jqOrderBy)return this.length;for(let t=0;t<this.length;t++)if(void 0!==this[t]&&null!==this[t]){if(this.__compareItems(e,this[t])<0)return t}else console.warn(`jq-repeat: Encountered an undefined or null item at index ${t} during sorting in scope ${this.__jqRepeatId}. Skipping comparison.`);return this.length}splice(e,...r){let i,n=!1;if("string"==typeof e&&this.__jqIndexKey){if(i=this.indexOf(e),n=!0,-1===i){let t=Number(e);if(!isNaN(t)&&t>=0&&t<this.length)i=t,n=!1;else{if(!(0===r[0]&&r.length>1))return[];i=Math.max(0,t),n=!1}}}else"number"==typeof e?i=e:(i=this.indexOf(e),n=!0);if(n&&-1===i&&(r[0]>0||1===r.length))return[];let l=r[0]??this.length-i,h=r.slice(1);i>this.length&&(i=this.length),i<0&&(i=Math.max(0,this.length+i)),l=Math.min(l,this.length-i);let o=this.slice(i,i+l);for(let e=0;e<o.length;e++){let t=o[e];t&&t.__jq_$el&&(a(t.__jq_$el),this.__take(t.__jq_$el,t,this))}const _=super.splice(i,l,...h);if(h.length>0){let e=null;e=i>0&&this[i-1]&&this[i-1].__jq_$el?this[i-1].__jq_$el:this.$this;for(let r=0;r<h.length;r++){let n=h[r],a=this.__buildData(i+r,n),l=t(s.render(this.__jqTemplate,a)).addClass("jq-repeat-"+this.__jqRepeatId).attr("jq-repeat-scope",this.__jqRepeatId);this.__jqIndexKey&&n.hasOwnProperty(this.__jqIndexKey)?l.attr("jq-repeat-index",n[this.__jqIndexKey]):l.attr("jq-repeat-index",i+r),e&&e.length?e.after(l):this.$this.after(l),e=l,Object.defineProperty(n,"__jq_$el",{value:l,writable:!0,enumerable:!1,configurable:!0}),this.__put(l,n,this)}}for(let e=i;e<this.length;e++)this[e]&&this[e].__jq_$el&&(this.__jqIndexKey&&this[e].hasOwnProperty(this.__jqIndexKey)?this[e].__jq_$el.attr("jq-repeat-index",this[e][this.__jqIndexKey]):this[e].__jq_$el.attr("jq-repeat-index",e),this[e].__jq_$el.attr("jq-repeat-scope",this.__jqRepeatId));return _}push(...e){if(!this.__jqOrderBy){const t=this.length||0;return this.splice(t,0,...e)}for(let t=0;t<e.length;++t){const s=e[t],r=this.__findInsertionIndex(s);this.splice(r,0,s)}return this.length}pop(){return this.splice(-1,1)[0]}reverse(){if(this.__jqOrderBy){console.warn("jq-repeat: Calling 'reverse()' on a list with 'jr-order-by' defined. This operation might not yield the expected stable sorted order.");let e=[];for(let t=0;t<this.length;t++)this[t]&&this[t].__jq_$el&&e.push(this[t].__jq_$el.detach());super.reverse();let r=this.$this;for(let e=0;e<this.length;e++){const i=this[e];if(i&&i.__jq_$el){const n=this.__buildData(e,i),a=t(s.render(this.__jqTemplate,n)).addClass("jq-repeat-"+this.__jqRepeatId).attr("jq-repeat-scope",this.__jqRepeatId);this.__jqIndexKey&&i.hasOwnProperty(this.__jqIndexKey)?a.attr("jq-repeat-index",i[this.__jqIndexKey]):a.attr("jq-repeat-index",e),r.after(a),Object.defineProperty(i,"__jq_$el",{value:a,writable:!0,enumerable:!1,configurable:!0}),r=a}}}else{let e=[];for(let t=0;t<this.length;t++)this[t]&&this[t].__jq_$el&&e.push(this[t].__jq_$el.detach());e.reverse();let t=this.$this;for(let s=0;s<e.length;s++)t.after(e[s]),t=e[s];super.reverse();for(let e=0;e<this.length;e++)this[e]&&this[e].__jq_$el&&(this.__jqIndexKey||this[e].__jq_$el.attr("jq-repeat-index",e))}return this}remove(e,t){let s;s=1===arguments.length?this.indexOf(e):this.indexOf(e,t),-1!==s&&this.splice(s,1)}empty(){return this.splice(0,this.length)}shift(){return this.splice(0,1)[0]}unshift(...e){if(!this.__jqOrderBy)return this.splice(0,0,...e);for(let t=e.length-1;t>=0;--t){const s=e[t],r=this.__findInsertionIndex(s);this.splice(r,0,s)}return this.length}indexOf(e,t){if("number"==typeof e)return e>=0&&e<this.length?e:-1;let s,r;if(2===arguments.length)s=e,r=t;else{if(1!==arguments.length)return console.error("jq-repeat: Invalid arguments for indexOf method.",arguments),-1;if("object"==typeof e&&null!==e){for(let t=0;t<this.length;++t)if(this[t]===e)return t;return-1}if(s=this.__jqIndexKey,r=e,!s)return console.warn(`jq-repeat: Cannot use indexOf with a single value argument without a 'jq-index-key' specified for scope '${this.__jqRepeatId}'.`),-1}for(let e=0;e<this.length;++e)if(this[e]&&this[e].hasOwnProperty(s)&&this[e][s]===r)return e;return-1}update(e,t,s){let n,a;if("object"==typeof e&&void 0===t&&void 0===s){if(!(this.length>0))return console.warn(`jq-repeat: Calling update(data) on an empty list '${this.__jqRepeatId}'. Item will be pushed instead.`),this.push(e);n=0,a=e}else if("number"==typeof e&&"object"==typeof t)n=e,a=t;else if("string"==typeof e&&"string"==typeof t&&"object"==typeof s)n=this.indexOf(e,t),a=s;else{if("string"!=typeof e||"object"!=typeof t||void 0!==s)return console.error("jq-repeat: Invalid arguments for update method.",arguments),null;n=this.indexOf(e),a=t}if(-1===n||n>=this.length)return console.warn(`jq-repeat: Update target not found at index ${n} or by key/value. No update performed for scope '${this.__jqRepeatId}'.`),null;if(!this[n])return console.warn(`jq-repeat: Item at calculated index ${n} is null or undefined for scope '${this.__jqRepeatId}'. Cannot update.`),null;return function(e,t,s,...n){r[e]?r[e].args=n:(r[e]={args:null,minDelay:t,callBack:s},s(...n),setTimeout(i,t,e))}(this.__jqRepeatId+"_"+n,50,this.__updateDom.bind(this),n,a)}__updateDom(e,r){let i=null,n=null;if(!this[e].__jq_$el)return console.warn(`jq-repeat: Item at index ${e} exists, but its DOM element reference (__jq_$el) is null or missing for scope '${this.__jqRepeatId}'.`),null;if(i=t.extend(!0,{},this[e]),n=this[e].__jq_$el,a(n),this[e]=t.extend(!0,this[e],r),this.__jqOrderBy&&0!==this.__compareItems(i,this[e])){const r=this[e];n&&n.length&&this.__take(n,r,this),super.splice(e,1);const i=this.__findInsertionIndex(r);super.splice(i,0,r);const a=this.__buildData(i,r),l=t(s.render(this.__jqTemplate,a)).addClass("jq-repeat-"+this.__jqRepeatId).attr("jq-repeat-scope",this.__jqRepeatId);this.__jqIndexKey&&r.hasOwnProperty(this.__jqIndexKey)?l.attr("jq-repeat-index",r[this.__jqIndexKey]):l.attr("jq-repeat-index",i);let h=null;h=i>0&&this[i-1]&&this[i-1].__jq_$el?this[i-1].__jq_$el:this.$this,h&&h.length?h.after(l):this.$this.after(l),Object.defineProperty(r,"__jq_$el",{value:l,writable:!0,enumerable:!1,configurable:!0}),this.__put(l,r,this);for(let e=0;e<this.length;e++)this[e]&&this[e].__jq_$el&&!this.__jqIndexKey&&this[e].__jq_$el.attr("jq-repeat-index",e);return l}const l=this.__buildData(e,this[e]),h=t(s.render(this.__jqTemplate,l));return h.attr("jq-repeat-scope",this.__jqRepeatId),this.__jqIndexKey&&this[e].hasOwnProperty(this.__jqIndexKey)?h.attr("jq-repeat-index",this[e][this.__jqIndexKey]):h.attr("jq-repeat-index",e),h.addClass(`jq-repeat-${this.__jqRepeatId}`),this.__putUpdate(n,h,this[e],this),this[e].__jq_$el=h,h}getByKey(...e){return this[this.indexOf(...e)]}__put(e,t,s){e.show()}__take(e,t,s){e&&e.length&&e.remove(),t&&(t.__jq_$el=null)}__putUpdate(e,t,s,r){t.show(),e.replaceWith(t)}__parseData(e){let t={...e};for(let e of Object.keys(t))this.parseKeys[e]&&(t[e]=this.parseKeys[e](t[e],e,t));return t}__buildData(e,t){const s=this.__jqParentIndex;return{...this.__parseData(t),nestedTemplates:this.__parseNestedTemplates(e,t),_parent:this._parentData,_index:e,_list:this,_actualParentIndex:s}}__parseNestedTemplates(e,s){let r=[];for(let e in this.nestedTemplates){let s=t(`${this.nestedTemplates[e]}`);s.attr("jq-repeat-parent",this.__jqRepeatId),s.attr("jq-repeat-parent-index",this.__jqParentIndex),r[e]=s[0].outerHTML}return r}}var h=function(e){const s=t(e),r=s.attr("jq-repeat");if(!r)return void console.error("jq-repeat: Element missing 'jq-repeat' attribute:",e);const i={};t.each(s[0].attributes,function(){if(this.name.startsWith("jq-")||this.name.startsWith("jr-")){const e=this.name.replace(/^(jq-|jr-)/,"").replace(/-([a-z])/g,e=>e[1].toUpperCase());i[e]=this.value}});let a=null,h=null,o=null;if(s.attr("jq-repeat-parent")){h=s.attr("jq-repeat-parent");const e=s.parent().closest(`[jq-repeat-scope="${h}"]`);e.length?(o=e.attr("jq-repeat-index"),t.scope[h]&&t.scope[h].__jqIndexKey&&t.scope[h].getByKey(t.scope[h].__jqIndexKey,o)?a=t.scope[h].getByKey(t.scope[h].__jqIndexKey,o):!t.scope[h]||t.scope[h].__jqIndexKey||isNaN(Number(o))?console.warn(`jq-repeat: Parent scope '${h}' or item with index/ID '${o}' not found for nested element.`):a=t.scope[h][Number(o)]):console.warn(`jq-repeat: Could not find parent element for scope '${h}'.`)}const _=[];s.find("[jq-repeat]").each((e,s)=>{let r=_.length,i=`${s.outerHTML}`;_.push(i),t(s).replaceWith(`{{{ nestedTemplates.${r} }}}`)}),s.removeAttr("jq-repeat");const p=s[0].outerHTML,d=new l(e,r,i,a,h,o,p,_),c=n[r]||[];n[r]=d;for(const e of Object.keys(c))Number.isInteger(Number(e))&&Number(e)>=0?d.push(c[e]):void 0!==d[e]&&null!==d[e]||(d[e]=c[e])};t.fn.scopeGetEl=function(){return this.closest("[jq-repeat-scope]")},t.fn.scopeGet=function(){let e=this.scopeGetEl();if(e&&e.attr("jq-repeat-scope"))return t.scope[e.attr("jq-repeat-scope")]},t.fn.scopeItem=function(){let e=this.scopeGetEl();if(e){const s=e.attr("jq-repeat-scope"),r=e.attr("jq-repeat-index"),i=t.scope[s];if(i)return i.__jqIndexKey?i.getByKey(i.__jqIndexKey,r):i[Number(r)]}},t.fn.scopeItemUpdate=function(e){let s=this.scopeGetEl();if(s){const r=s.attr("jq-repeat-scope"),i=s.attr("jq-repeat-index"),n=t.scope[r];n&&(n.__jqIndexKey?n.update(n.__jqIndexKey,i,e):n.update(Number(i),e))}},t.fn.scopeItemRemove=function(){let e=this.scopeGetEl();if(e){const s=e.attr("jq-repeat-scope"),r=e.attr("jq-repeat-index"),i=t.scope[s];i&&(i.__jqIndexKey?i.remove(r):i.remove(Number(r)))}},t(document).ready(function(){new MutationObserver(function(e){e.forEach(e=>{if("childList"===e.type){e.addedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){if(e.hasAttribute("jq-repeat")){const s=t(e).attr("jq-repeat");return h(t(e)),void(s&&t.scope[s]&&n.onNew.call(t.scope[s]))}{const s=e.querySelectorAll("[jq-repeat]");s.length>0&&s.forEach(e=>{const s=t(e).attr("jq-repeat");h(t(e)),s&&t.scope[s]&&n.onNew.call(t.scope[s])})}}})}})}).observe(document.body,{childList:!0,subtree:!0}),t("[jq-repeat]").each(function(e,s){if(0!==t(s).closest("body").length){const e=t(s).attr("jq-repeat");h(t(s)),e&&t.scope[e]&&n.onNew.call(t.scope[e])}})})}(jQuery,Mustache)}();
//# sourceMappingURL=jq-repeat.min.js.map

{"version":3,"file":"jq-repeat.min.js","sources":["../../src/jq-repeat.js"],"sourcesContent":["/*\nAuthor William Mantly Jr <wmantly@gmail.com>\nhttps://github.com/wmantly/jq-repeat\nMIT license\n*/\n\nclass CallbackQueue {\n\tconstructor(callbacks) {\n\t\tthis.__callbacks = [];\n\n\t\tfor (let callback of Array.isArray(callbacks) ? callbacks : [callbacks]) {\n\t\t\tthis.push(callback);\n\t\t}\n\t}\n\n\tpush(callback) {\n\t\tif (callback instanceof Function) {\n\t\t\tthis.__callbacks.push(callback);\n\t\t}\n\t}\n\n\tcall() {\n\t\tlet args = arguments;\n\t\tthis.__callbacks.forEach(callback => {\n\t\t\tcallback(...args);\n\t\t});\n\t}\n}\n\n// Encapsulate the library within an IIFE to prevent global scope pollution\n(function($, Mustache) {\n\t'use strict';\n\n\tconst throttleMap = {};\n\n\tfunction throttleCheck(key) {\n\t    if (throttleMap[key] && throttleMap[key].args !== null) {\n\t        // Call the callback with the stored arguments\n\t        throttleMap[key].callBack(...throttleMap[key].args);\n\t        throttleMap[key].args = null;\n\t        \n\t        // Schedule next check\n\t        setTimeout(throttleCheck, throttleMap[key].minDelay, key);\n\t    } else {\n\t        // Clean up when no more pending calls\n\t        delete throttleMap[key];\n\t    }\n\t}\n\n\tfunction throttle(key, minDelay, callBack, ...args) {\n\t    if (throttleMap[key]) {\n\t        // Update arguments for pending call\n\t        throttleMap[key].args = args;\n\t    } else {\n\t        // First call - execute immediately and set up throttling\n\t        throttleMap[key] = {\n\t            args: null,\n\t            minDelay,\n\t            callBack,\n\t        };\n\n\t        // Execute immediately\n\t        callBack(...args);\n\t        \n\t        // Schedule throttle check\n\t        setTimeout(throttleCheck, minDelay, key);\n\t    }\n\t}\n\n\t// Internal scope object for managing repeat lists\n\tconst _scope = {};\n\n\tObject.defineProperty(_scope, 'onNew', {\n\t\tvalue: new CallbackQueue(),\n\t\twritable: true,\n\t\tenumerable: false,\n\t\tconfigurable: true\n\t});\n\n\t$.scope = new Proxy(_scope, {\n\t\tget(obj, prop) {\n\t\t\tif (!obj[prop]) {\n\t\t\t\tobj[prop] = [];\n\t\t\t}\n\t\t\treturn Reflect.get(...arguments);\n\t\t},\n\t\tset(obj, prop, value) {\n\t\t\treturn Reflect.set(...arguments);\n\t\t},\n\t});\n\n\t// --- Helper function to clean up nested jq-repeat elements ---\n\tfunction cleanupNestedRepeats($element) {\n\t\tif (!$element || !$element.length) return;\n\t\t\n\t\t// Find all nested jq-repeat elements within this element\n\t\tconst $nestedRepeats = $element.find('[jq-repeat-scope]');\n\t\t\n\t\t$nestedRepeats.each(function() {\n\t\t\tconst $nested = $(this);\n\t\t\tconst nestedScopeId = $nested.attr('jq-repeat-scope');\n\t\t\t\n\t\t\tif (nestedScopeId && $.scope[nestedScopeId]) {\n\t\t\t\t// Clean up the nested scope instance\n\t\t\t\tconst nestedInstance = $.scope[nestedScopeId];\n\t\t\t\t\n\t\t\t\t// Call take on all items to clean up their DOM elements\n\t\t\t\tfor (let i = 0; i < nestedInstance.length; i++) {\n\t\t\t\t\tif (nestedInstance[i] && nestedInstance[i].__jq_$el) {\n\t\t\t\t\t\tnestedInstance.__take(nestedInstance[i].__jq_$el, nestedInstance[i], nestedInstance);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Clear the array\n\t\t\t\tnestedInstance.length = 0;\n\t\t\t\t\n\t\t\t\t// Remove from global scope\n\t\t\t\tdelete $.scope[nestedScopeId];\n\t\t\t}\n\t\t});\n\t}\n\n\t// --- ES6 Class for jq-repeat lists ---\n\tclass RepeatList extends Array {\n\t\t// This is the fix: tells built-in Array methods (like slice, map, filter)\n\t\t// to return plain Array instances instead of RepeatList instances.\n\t\tstatic get [Symbol.species]() {\n\t\t\treturn Array;\n\t\t}\n\n\t\tconstructor(element, scopeId, options, parentData, parentId, parentIndex, templateHTML, nestedTemplates) {\n\t\t\tsuper();\n\n\t\t\tthis.__jqRepeatId = scopeId;\n\t\t\tthis.options = options;\n\n\t\t\t// Store the actual indexKey property name for quick access\n\t\t\tif (options && options.indexKey !== undefined) {\n\t\t\t\tthis.__jqIndexKey = options.indexKey;\n\t\t\t}\n\n\t\t\t// Store sorting options\n\t\t\tif (options && options.orderBy !== undefined) {\n\t\t\t\tthis.__jqOrderBy = options.orderBy;\n\t\t\t\tthis.__jqOrderReverse = options.orderReverse === 'true';\n\t\t\t} else {\n\t\t\t\tthis.__jqOrderBy = null;\n\t\t\t\tthis.__jqOrderReverse = false;\n\t\t\t}\n\n\t\t\tthis._parentData = parentData;\n\t\t\tthis.__jqParent = parentId;\n\t\t\tthis.__jqParentIndex = parentIndex;\n\t\t\tthis.__jqTemplate = templateHTML;\n\t\t\tthis.nestedTemplates = nestedTemplates;\n\n\t\t\tthis.$this = $(`<script type=\"x-tmpl-mustache\" id=\"jq-repeat-holder-${this.__jqRepeatId}\"><\\/script>`);\n\t\t\t$(element).replaceWith(this.$this);\n\n\t\t\tlet tokenArray = Mustache.parse(this.__jqTemplate);\n\n\t\t\tthis.templateKeys = [];\n\n\t\t\tfor(let token of tokenArray){\n\t\t\t\tif(['name', '#', '^'].includes(token[0])){\n\t\t\t\t\tthis.templateKeys.push(token[1]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.templateKeysObj = this.__parseTemplateKeys(tokenArray)\n\n\t\t\tthis.parseKeys = {};\n\n\t\t\tfor (let prop of ['put', 'take', 'putUpdate', 'parseData']) {\n\t\t\t\tObject.defineProperty(this, prop, {\n\t\t\t\t\tenumerable: false,\n\t\t\t\t\tget() {\n\t\t\t\t\t\treturn this[`__${prop}`];\n\t\t\t\t\t},\n\t\t\t\t\tset(value) {\n\t\t\t\t\t\tif (typeof value === 'function') {\n\t\t\t\t\t\t\tthis[`__${prop}`] = value;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.warn(`jq-repeat: Attempted to set '${prop}' to a non-function value for scope '${this.__jqRepeatId}'.`);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n/*\t\t__parseTemplateKeys(parsed, obj){\n\t\t\tfor(let token of parsed){\n\t\t\t\tif(['name', '^'].includes(token[0])){\n\t\t\t\t\tobj[token[1].split('.')[0].split('[')[0]] = null;\n\t\t\t\t}\n\t\t\t\tif(token[0] === '#'){\n\t\t\t\t\tobj[token[1]] = {};\n\t\t\t\t\tthis.__parseTemplateKeys(token[4], obj[token[1]])\n\t\t\t\t}\n\t\t\t\tif(token[0] === '&'){\n\t\t\t\t\tobj[token[1].split('.')[0].split('[')[0]] = null;\n\t\t\t\t}\n\t\t\t}\n\t\t}*/\n\n\t__parseTemplateKeys(tokenArray){\n\t\tconst keyMap = {};\n\n\t\ttokenArray.forEach(token => {\n\t\tconst type = token[0];\n\t\tconst key = token[1];\n\n\t\t// We only care about tokens that represent a variable, section, or partial\n\t\tif (['name', '#', '^', '>', '&'].includes(type)) {\n\t\t  // Handle dot notation and array-like keys\n\t\t  const keyParts = key.split('.');\n\t\t  let currentMap = keyMap;\n\n\t\t  keyParts.forEach((part, index) => {\n\t\t    // Check for array notation like `user[0]` and treat it as a plain key\n\t\t    const cleanPart = part.split('[')[0];\n\n\t\t    if (index === keyParts.length - 1) {\n\t\t      // This is the last part of the key path\n\t\t      if (type === '#' || type === '^') {\n\t\t        // For sections, make a recursive call to get nested keys\n\t\t        currentMap[cleanPart] = this.__parseTemplateKeys(token[4]);\n\t\t      } else {\n\t\t        // For simple variables or partials, just set the value to null\n\t\t        currentMap[cleanPart] = null;\n\t\t      }\n\t\t    } else {\n\t\t      // This is an intermediate part of the key path\n\t\t      // If the part doesn't exist or isn't an object, create a new object\n\t\t      if (!currentMap[cleanPart] || typeof currentMap[cleanPart] !== 'object') {\n\t\t        currentMap[cleanPart] = {};\n\t\t      }\n\t\t      // Move to the next level of the object\n\t\t      currentMap = currentMap[cleanPart];\n\t\t    }\n\t\t  });\n\t\t}\n\t\t});\n\n\t\treturn keyMap;\n\t}\n\n\n\t\t/**\n\t\t * Compares two items based on the __jqOrderBy key and __jqOrderReverse flag.\n\t\t */\n\t\t__compareItems(itemA, itemB) {\n\t\t\tif (!this.__jqOrderBy) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tif (itemB === undefined || itemB === null) {\n\t\t\t    return 0;\n\t\t\t}\n\n\t\t\tconst valA = itemA[this.__jqOrderBy];\n\t\t\tconst valB = itemB[this.__jqOrderBy];\n\n\t\t\t// Handle undefined/null values\n\t\t\tif (valA === undefined || valA === null) return (valB === undefined || valB === null) ? 0 : (this.__jqOrderReverse ? -1 : 1);\n\t\t\tif (valB === undefined || valB === null) return (this.__jqOrderReverse ? 1 : -1);\n\n\t\t\tlet comparison = 0;\n\n\t\t\t// Numeric comparison\n\t\t\tif (typeof valA === 'number' && typeof valB === 'number') {\n\t\t\t\tcomparison = valA - valB;\n\t\t\t}\n\t\t\t// String comparison (case-insensitive)\n\t\t\telse if (typeof valA === 'string' && typeof valB === 'string') {\n\t\t\t\tcomparison = valA.localeCompare(valB, undefined, { sensitivity: 'base' });\n\t\t\t}\n\t\t\t// Date comparison\n\t\t\telse if (valA instanceof Date && valB instanceof Date) {\n\t\t\t\tcomparison = valA.getTime() - valB.getTime();\n\t\t\t} else {\n\t\t\t\t// Fallback to string comparison\n\t\t\t\tcomparison = String(valA).localeCompare(String(valB), undefined, { sensitivity: 'base' });\n\t\t\t}\n\n\t\t\treturn this.__jqOrderReverse ? -comparison : comparison;\n\t\t}\n\n\t\t/**\n\t\t * Finds the correct insertion index for a new item to maintain sorted order.\n\t\t */\n\t\t__findInsertionIndex(newItem) {\n\t\t    if (!this.__jqOrderBy) {\n\t\t        return this.length;\n\t\t    }\n\n\t\t    for (let i = 0; i < this.length; i++) {\n\t\t        if (this[i] === undefined || this[i] === null) {\n\t\t            console.warn(`jq-repeat: Encountered an undefined or null item at index ${i} during sorting in scope ${this.__jqRepeatId}. Skipping comparison.`);\n\t\t            continue;\n\t\t        }\n\t\t        if (this.__compareItems(newItem, this[i]) < 0) {\n\t\t            return i;\n\t\t        }\n\t\t    }\n\t\t    return this.length;\n\t\t}\n\n\t\tsplice(inputValue, ...args) {\n\t\t\tlet index;\n\t\t\tlet wasIndexLookup = false;\n\n\t\t\t// Determine the starting index for splice\n\t\t\tif (typeof inputValue === \"string\" && this.__jqIndexKey) {\n\t\t\t\tindex = this.indexOf(inputValue);\n\t\t\t\twasIndexLookup = true;\n\t\t\t\tif (index === -1) {\n\t\t\t\t\tlet numericInput = Number(inputValue);\n\t\t\t\t\tif (!isNaN(numericInput) && numericInput >= 0 && numericInput < this.length) {\n\t\t\t\t\t\tindex = numericInput;\n\t\t\t\t\t\twasIndexLookup = false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (args[0] === 0 && args.length > 1) {\n\t\t\t\t\t\t\tindex = Math.max(0, numericInput);\n\t\t\t\t\t\t\twasIndexLookup = false;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn [];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (typeof inputValue === 'number') {\n\t\t\t\t\tindex = inputValue;\n\t\t\t\t} else {\n\t\t\t\t\tindex = this.indexOf(inputValue);\n\t\t\t\t\twasIndexLookup = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Only return empty array if indexOf was called and returned -1 (item not found)\n\t\t\t// Don't return empty for negative numeric indices like -1 used by pop()\n\t\t\tif (wasIndexLookup && index === -1 && (args[0] > 0 || args.length === 1)) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tlet howMany = args[0] ?? (this.length - index);\n\t\t\tlet toAdd = args.slice(1);\n\n\t\t\t// Normalize index and howMany\n\t\t\tif (index > this.length) index = this.length;\n\t\t\tif (index < 0) index = Math.max(0, this.length + index);\n\t\t\thowMany = Math.min(howMany, this.length - index);\n\n\t\t\tlet removedItems = this.slice(index, index + howMany);\n\n\t\t\t// --- DOM REMOVAL with nested cleanup ---\n\t\t\tfor (let i = 0; i < removedItems.length; i++) {\n\t\t\t\tlet item = removedItems[i];\n\t\t\t\tif (item && item.__jq_$el) {\n\t\t\t\t\t// Clean up nested repeats before removing the element\n\t\t\t\t\tcleanupNestedRepeats(item.__jq_$el);\n\t\t\t\t\tthis.__take(item.__jq_$el, item, this);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Perform native Array.splice\n\t\t\tconst nativeSpliceResult = super.splice(index, howMany, ...toAdd);\n\n\t\t\t// --- DOM ADDITION / RE-INSERTION ---\n\t\t\tif (toAdd.length > 0) {\n\t\t\t\tlet previousElement = null;\n\t\t\t\tif (index > 0 && this[index - 1] && this[index - 1].__jq_$el) {\n\t\t\t\t\tpreviousElement = this[index - 1].__jq_$el;\n\t\t\t\t} else {\n\t\t\t\t\tpreviousElement = this.$this;\n\t\t\t\t}\n\n\t\t\t\tfor (let i = 0; i < toAdd.length; i++) {\n\t\t\t\t\tlet newItemData = toAdd[i];\n\t\t\t\t\tlet renderData = this.__buildData(index + i, newItemData);\n\t\t\t\t\tlet $render = $(Mustache.render(this.__jqTemplate, renderData))\n\t\t\t\t\t\t.addClass(\"jq-repeat-\" + this.__jqRepeatId)\n\t\t\t\t\t\t.attr(\"jq-repeat-scope\", this.__jqRepeatId);\n\n\t\t\t\t\tif (this.__jqIndexKey && newItemData.hasOwnProperty(this.__jqIndexKey)) {\n\t\t\t\t\t\t$render.attr(\"jq-repeat-index\", newItemData[this.__jqIndexKey]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$render.attr(\"jq-repeat-index\", index + i);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (previousElement && previousElement.length) {\n\t\t\t\t\t\tpreviousElement.after($render);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.$this.after($render);\n\t\t\t\t\t}\n\t\t\t\t\tpreviousElement = $render;\n\n\t\t\t\t\tObject.defineProperty(newItemData, \"__jq_$el\", {\n\t\t\t\t\t\tvalue: $render,\n\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\tenumerable: false,\n\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.__put($render, newItemData, this);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// --- RE-INDEXING REMAINING ELEMENTS ---\n\t\t\tfor (let i = index; i < this.length; i++) {\n\t\t\t\tif (this[i] && this[i].__jq_$el) {\n\t\t\t\t\tif (this.__jqIndexKey && this[i].hasOwnProperty(this.__jqIndexKey)) {\n\t\t\t\t\t\tthis[i].__jq_$el.attr(\"jq-repeat-index\", this[i][this.__jqIndexKey]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis[i].__jq_$el.attr(\"jq-repeat-index\", i);\n\t\t\t\t\t}\n\t\t\t\t\tthis[i].__jq_$el.attr(\"jq-repeat-scope\", this.__jqRepeatId);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn nativeSpliceResult;\n\t\t}\n\n\t\tpush(...args) {\n\t\t\tif (!this.__jqOrderBy) {\n\t\t\t\tconst index = this.length || 0;\n\t\t\t\treturn this.splice(index, 0, ...args);\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < args.length; ++i) {\n\t\t\t\tconst newItem = args[i];\n\t\t\t\tconst insertionIndex = this.__findInsertionIndex(newItem);\n\t\t\t\tthis.splice(insertionIndex, 0, newItem);\n\t\t\t}\n\t\t\treturn this.length;\n\t\t}\n\n\t\tpop() {\n\t\t\treturn this.splice(-1, 1)[0];\n\t\t}\n\n\t\treverse() {\n\t\t\tif (!this.__jqOrderBy) {\n\t\t\t\tlet elementsToReverse = [];\n\t\t\t\tfor (let i = 0; i < this.length; i++) {\n\t\t\t\t\tif (this[i] && this[i].__jq_$el) {\n\t\t\t\t\t\telementsToReverse.push(this[i].__jq_$el.detach());\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\telementsToReverse.reverse();\n\n\t\t\t\tlet lastElement = this.$this;\n\t\t\t\tfor (let i = 0; i < elementsToReverse.length; i++) {\n\t\t\t\t\tlastElement.after(elementsToReverse[i]);\n\t\t\t\t\tlastElement = elementsToReverse[i];\n\t\t\t\t}\n\n\t\t\t\tsuper.reverse();\n\n\t\t\t\tfor (let i = 0; i < this.length; i++) {\n\t\t\t\t\tif (this[i] && this[i].__jq_$el) {\n\t\t\t\t\t\tif (!this.__jqIndexKey) {\n\t\t\t\t\t\t\tthis[i].__jq_$el.attr(\"jq-repeat-index\", i);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.warn(`jq-repeat: Calling 'reverse()' on a list with 'jr-order-by' defined. This operation might not yield the expected stable sorted order.`);\n\n\t\t\t\tlet detachedElements = [];\n\t\t\t\tfor (let i = 0; i < this.length; i++) {\n\t\t\t\t\tif (this[i] && this[i].__jq_$el) {\n\t\t\t\t\t\tdetachedElements.push(this[i].__jq_$el.detach());\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tsuper.reverse();\n\n\t\t\t\tlet previousElement = this.$this;\n\t\t\t\tfor (let i = 0; i < this.length; i++) {\n\t\t\t\t\tconst item = this[i];\n\t\t\t\t\tif (item && item.__jq_$el) {\n\t\t\t\t\t\tconst renderData = this.__buildData(i, item);\n\t\t\t\t\t\tconst $render = $(Mustache.render(this.__jqTemplate, renderData))\n\t\t\t\t\t\t\t.addClass(\"jq-repeat-\" + this.__jqRepeatId)\n\t\t\t\t\t\t\t.attr(\"jq-repeat-scope\", this.__jqRepeatId);\n\n\t\t\t\t\t\tif (this.__jqIndexKey && item.hasOwnProperty(this.__jqIndexKey)) {\n\t\t\t\t\t\t\t$render.attr(\"jq-repeat-index\", item[this.__jqIndexKey]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$render.attr(\"jq-repeat-index\", i);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tpreviousElement.after($render);\n\t\t\t\t\t\tObject.defineProperty(item, \"__jq_$el\", {\n\t\t\t\t\t\t\tvalue: $render,\n\t\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\t\tenumerable: false,\n\t\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tpreviousElement = $render;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this;\n\t\t}\n\n\t\tremove(keyOrValue, value) {\n\t\t\tlet index;\n\t\t\tif (arguments.length === 1) {\n\t\t\t\tindex = this.indexOf(keyOrValue);\n\t\t\t} else {\n\t\t\t\tindex = this.indexOf(keyOrValue, value);\n\t\t\t}\n\n\t\t\tif (index === -1) return;\n\t\t\tthis.splice(index, 1);\n\t\t}\n\n\t\tempty() {\n\t\t\treturn this.splice(0, this.length);\n\t\t}\n\n\t\tshift() {\n\t\t\treturn this.splice(0, 1)[0];\n\t\t}\n\n\t\tunshift(...args) {\n\t\t\tif (!this.__jqOrderBy) {\n\t\t\t\treturn this.splice(0, 0, ...args);\n\t\t\t}\n\n\t\t\tfor (let i = args.length - 1; i >= 0; --i) {\n\t\t\t\tconst newItem = args[i];\n\t\t\t\tconst insertionIndex = this.__findInsertionIndex(newItem);\n\t\t\t\tthis.splice(insertionIndex, 0, newItem);\n\t\t\t}\n\t\t\treturn this.length;\n\t\t}\n\n\t\t/**\n\t\t * Finds the index of an item in the list.\n\t\t */\n\t\tindexOf(keyOrValue, valueToMatch) {\n\t\t\tif (typeof keyOrValue === 'number') {\n\t\t\t\tif (keyOrValue >= 0 && keyOrValue < this.length) {\n\t\t\t\t\treturn keyOrValue;\n\t\t\t\t}\n\t\t\t\treturn -1;\n\t\t\t}\n\n\t\t\tlet searchKey;\n\t\t\tlet searchValue;\n\n\t\t\tif (arguments.length === 2) {\n\t\t\t\tsearchKey = keyOrValue;\n\t\t\t\tsearchValue = valueToMatch;\n\t\t\t} else if (arguments.length === 1) {\n\t\t\t\tif (typeof keyOrValue === 'object' && keyOrValue !== null) {\n\t\t\t\t\tfor (let i = 0; i < this.length; ++i) {\n\t\t\t\t\t\tif (this[i] === keyOrValue) {\n\t\t\t\t\t\t\treturn i;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn -1;\n\t\t\t\t} else {\n\t\t\t\t\tsearchKey = this.__jqIndexKey;\n\t\t\t\t\tsearchValue = keyOrValue;\n\n\t\t\t\t\tif (!searchKey) {\n\t\t\t\t\t\tconsole.warn(`jq-repeat: Cannot use indexOf with a single value argument without a 'jq-index-key' specified for scope '${this.__jqRepeatId}'.`);\n\t\t\t\t\t\treturn -1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.error(\"jq-repeat: Invalid arguments for indexOf method.\", arguments);\n\t\t\t\treturn -1;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < this.length; ++i) {\n\t\t\t\tif (this[i] && this[i].hasOwnProperty(searchKey) && this[i][searchKey] === searchValue) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn -1;\n\t\t}\n\n\t\t// Fixed update method\n\t\tupdate(keyOrIndex, valueOrData, dataToUpdate) {\n\t\t    let index;\n\t\t    let data;\n\n\t\t    if (typeof keyOrIndex === 'object' && valueOrData === undefined && dataToUpdate === undefined) {\n\t\t        if (this.length > 0) {\n\t\t            index = 0;\n\t\t            data = keyOrIndex;\n\t\t        } else {\n\t\t            console.warn(`jq-repeat: Calling update(data) on an empty list '${this.__jqRepeatId}'. Item will be pushed instead.`);\n\t\t            return this.push(keyOrIndex);\n\t\t        }\n\t\t    } else if (typeof keyOrIndex === 'number' && typeof valueOrData === 'object') {\n\t\t        index = keyOrIndex;\n\t\t        data = valueOrData;\n\t\t    } else if (typeof keyOrIndex === 'string' && typeof valueOrData === 'string' && typeof dataToUpdate === 'object') {\n\t\t        index = this.indexOf(keyOrIndex, valueOrData);\n\t\t        data = dataToUpdate;\n\t\t    } else if (typeof keyOrIndex === 'string' && typeof valueOrData === 'object' && dataToUpdate === undefined) {\n\t\t        index = this.indexOf(keyOrIndex);\n\t\t        data = valueOrData;\n\t\t    } else {\n\t\t        console.error(\"jq-repeat: Invalid arguments for update method.\", arguments);\n\t\t        return null;\n\t\t    }\n\n\t\t    if (index === -1 || index >= this.length) {\n\t\t        console.warn(`jq-repeat: Update target not found at index ${index} or by key/value. No update performed for scope '${this.__jqRepeatId}'.`);\n\t\t        return null;\n\t\t    }\n\n\t\t    if (!this[index]) {\n\t\t        console.warn(`jq-repeat: Item at calculated index ${index} is null or undefined for scope '${this.__jqRepeatId}'. Cannot update.`);\n\t\t        return null;\n\t\t    }\n\n\t\t    const throttleKey = this.__jqRepeatId + '_' + index;\n\t\t    const boundUpdateDom = this.__updateDom.bind(this);\n\t\t    \n\t\t    return throttle(throttleKey, 50, boundUpdateDom, index, data);\n\t\t}\n\n\t\t__updateDom(index, data){\n\t\t\tlet originalItemData = null;\n\t\t\tlet originalDOMEl = null;\n\n            if (!this[index].__jq_$el) {\n                console.warn(`jq-repeat: Item at index ${index} exists, but its DOM element reference (__jq_$el) is null or missing for scope '${this.__jqRepeatId}'.`);\n                return null;\n            }\n\n\t\t\toriginalItemData = $.extend(true, {}, this[index]);\n\t\t\toriginalDOMEl = this[index].__jq_$el;\n\n\t\t\t// Clean up nested repeats before updating\n\t\t\tcleanupNestedRepeats(originalDOMEl);\n\n\t\t\t// Merge new data into the existing item\n\t\t\tthis[index] = $.extend(true, this[index], data);\n\n\t\t\t// Check if sorting position has changed\n\t\t\tif (this.__jqOrderBy) {\n\t\t\t\t// Simplified check for position change\n\t\t\t\tif (this.__compareItems(originalItemData, this[index]) !== 0) {\n\t\t\t\t\tconst itemToMove = this[index];\n\n\t\t\t\t\t// Remove from DOM and array\n\t\t\t\t\tif (originalDOMEl && originalDOMEl.length) {\n\t\t\t\t\t\tthis.__take(originalDOMEl, itemToMove, this);\n\t\t\t\t\t}\n\t\t\t\t\tsuper.splice(index, 1);\n\n\t\t\t\t\t// Find new insertion point and insert\n\t\t\t\t\tconst newInsertionIndex = this.__findInsertionIndex(itemToMove);\n\t\t\t\t\tsuper.splice(newInsertionIndex, 0, itemToMove);\n\n\t\t\t\t\t// Render at new position\n\t\t\t\t\tconst renderData = this.__buildData(newInsertionIndex, itemToMove);\n\t\t\t\t\tconst $render = $(Mustache.render(this.__jqTemplate, renderData))\n\t\t\t\t\t\t.addClass(\"jq-repeat-\" + this.__jqRepeatId)\n\t\t\t\t\t\t.attr(\"jq-repeat-scope\", this.__jqRepeatId);\n\n\t\t\t\t\tif (this.__jqIndexKey && itemToMove.hasOwnProperty(this.__jqIndexKey)) {\n\t\t\t\t\t\t$render.attr('jq-repeat-index', itemToMove[this.__jqIndexKey]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$render.attr('jq-repeat-index', newInsertionIndex);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet previousElement = null;\n\t\t\t\t\tif (newInsertionIndex > 0 && this[newInsertionIndex - 1] && this[newInsertionIndex - 1].__jq_$el) {\n\t\t\t\t\t\tpreviousElement = this[newInsertionIndex - 1].__jq_$el;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpreviousElement = this.$this;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (previousElement && previousElement.length) {\n\t\t\t\t\t\tpreviousElement.after($render);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.$this.after($render);\n\t\t\t\t\t}\n\n\t\t\t\t\tObject.defineProperty(itemToMove, \"__jq_$el\", {\n\t\t\t\t\t\tvalue: $render,\n\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\tenumerable: false,\n\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.__put($render, itemToMove, this);\n\n\t\t\t\t\t// Re-index elements\n\t\t\t\t\tfor (let i = 0; i < this.length; i++) {\n\t\t\t\t\t\tif (this[i] && this[i].__jq_$el && !this.__jqIndexKey) {\n\t\t\t\t\t\t\tthis[i].__jq_$el.attr(\"jq-repeat-index\", i);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $render;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Standard update (no position change)\n\t\t\tconst renderData = this.__buildData(index, this[index]);\n\t\t\tconst $render = $(Mustache.render(this.__jqTemplate, renderData));\n\n\t\t\t$render.attr('jq-repeat-scope', this.__jqRepeatId);\n\t\t\tif (this.__jqIndexKey && this[index].hasOwnProperty(this.__jqIndexKey)) {\n\t\t\t\t$render.attr('jq-repeat-index', this[index][this.__jqIndexKey]);\n\t\t\t} else {\n\t\t\t\t$render.attr('jq-repeat-index', index);\n\t\t\t}\n\t\t\t$render.addClass(`jq-repeat-${this.__jqRepeatId}`);\n\n\t\t\tthis.__putUpdate(originalDOMEl, $render, this[index], this);\n\n\t\t\tthis[index].__jq_$el = $render;\n\t\t\treturn $render;\n\t\t}\n\n\t\tgetByKey(...args) {\n\t\t\treturn this[this.indexOf(...args)];\n\t\t}\n\n\t\t// --- User-definable Helper Methods ---\n\n\t\t__put($el, item, list) {\n\t\t\t$el.show();\n\t\t}\n\n\t\t__take($el, item, list) {\n\t\t\tif ($el && $el.length) {\n\t\t\t\t$el.remove();\n\t\t\t}\n\t\t\tif (item) {\n\t\t\t\titem.__jq_$el = null;\n\t\t\t}\n\t\t}\n\n\t\t__putUpdate($el, $render, item, list) {\n\t\t\t$render.show();\n\t\t\t$el.replaceWith($render);\n\t\t}\n\n\t\t__parseData(data) {\n\t\t\tlet parsedData = { ...data };\n\t\t\tfor (let key of Object.keys(parsedData)) {\n\t\t\t\tif (this.parseKeys[key]) {\n\t\t\t\t\tparsedData[key] = this.parseKeys[key](parsedData[key], key, parsedData);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn parsedData;\n\t\t}\n\n\t\t// --- Internal Helper Methods ---\n\n\t\t__buildData(index, data) {\n\t\t\tconst actualParentIndex = this.__jqParentIndex;\n\t\t\treturn {\n\t\t\t\t...this.__parseData(data),\n\t\t\t\tnestedTemplates: this.__parseNestedTemplates(index, data),\n\t\t\t\t_parent: this._parentData,\n\t\t\t\t_index: index,\n\t\t\t\t_list: this,\n\t\t\t\t_actualParentIndex: actualParentIndex,\n\t\t\t};\n\t\t}\n\n\t\t__parseNestedTemplates(index, data) {\n\t\t\tlet templates = [];\n\t\t\tlet tempData = {\n\t\t\t\t...data,\n\t\t\t\t_parent: data,\n\t\t\t};\n\n\t\t\tfor (let idx in this.nestedTemplates) {\n\t\t\t\tlet $el = $(`${this.nestedTemplates[idx]}`);\n\n\t\t\t\t$el.attr('jq-repeat-parent', this.__jqRepeatId);\n\t\t\t\t$el.attr('jq-repeat-parent-index', this.__jqParentIndex);\n\t\t\t\ttemplates[idx] = $el[0].outerHTML;\n\t\t\t}\n\t\t\treturn templates;\n\t\t}\n\t}\n\n\tvar make = function(element) {\n\t\tconst $this = $(element);\n\n\t\tconst scopeId = $this.attr('jq-repeat');\n\t\tif (!scopeId) {\n\t\t\tconsole.error(\"jq-repeat: Element missing 'jq-repeat' attribute:\", element);\n\t\t\treturn;\n\t\t}\n\n\t\tconst options = {};\n\t\t$.each($this[0].attributes, function() {\n\t\t\tif (this.name.startsWith(\"jq-\") || this.name.startsWith(\"jr-\")) {\n\t\t\t\tconst optionName = this.name.replace(/^(jq-|jr-)/, '').replace(/-([a-z])/g, (g) => g[1].toUpperCase());\n\t\t\t\toptions[optionName] = this.value;\n\t\t\t}\n\t\t});\n\n\t\t// const parent = $this.scopeGet();\n\t\tlet parentData = null;\n\t\tlet parentId = null;\n\t\tlet parentIndex = null;\n\t\tif ($this.attr('jq-repeat-parent')) {\n\t\t\tparentId = $this.attr('jq-repeat-parent');\n\t\t\tconst parentElement = $this.parent().closest(`[jq-repeat-scope=\"${parentId}\"]`);\n\t\t\tif (parentElement.length) {\n\t\t\t\tparentIndex = parentElement.attr('jq-repeat-index');\n\t\t\t\tif ($.scope[parentId] && $.scope[parentId].__jqIndexKey && $.scope[parentId].getByKey($.scope[parentId].__jqIndexKey, parentIndex)) {\n\t\t\t\t\tparentData = $.scope[parentId].getByKey($.scope[parentId].__jqIndexKey, parentIndex);\n\t\t\t\t} else if ($.scope[parentId] && !$.scope[parentId].__jqIndexKey && !isNaN(Number(parentIndex))) {\n\t\t\t\t\tparentData = $.scope[parentId][Number(parentIndex)];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tconsole.warn(`jq-repeat: Parent scope '${parentId}' or item with index/ID '${parentIndex}' not found for nested element.`);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.warn(`jq-repeat: Could not find parent element for scope '${parentId}'.`);\n\t\t\t}\n\t\t}\n\n\n\t\tconst nestedTemplates = [];\n\t\t$this.find('[jq-repeat]').each((idx, el) => {\n\t\t\tlet templateIdx = nestedTemplates.length;\n\t\t\tlet template = `${el.outerHTML}`;\n\t\t\tnestedTemplates.push(template);\n\t\t\t// el.setAttribute('jq-parent-nestedTemplate-index', templateIdx)\n\t\t\t $(el).replaceWith(`{{{ nestedTemplates.${templateIdx} }}}`);\n\t\t});\n\n\t\t$this.removeAttr('jq-repeat');\n\n\t\tconst templateHTML = $this[0].outerHTML;\n\n\t\tconst repeatListInstance = new RepeatList(\n\t\t\telement,\n\t\t\tscopeId,\n\t\t\toptions,\n\t\t\tparentData,\n\t\t\tparentId,\n\t\t\tparentIndex,\n\t\t\ttemplateHTML,\n\t\t\tnestedTemplates\n\t\t);\n\n\t\tconst tempPreExistingData = _scope[scopeId] || [];\n\t\t_scope[scopeId] = repeatListInstance;\n\n\t\t// Process pre-existing data\n\t\tfor (const prop of Object.keys(tempPreExistingData)) {\n\t\t\tif (Number.isInteger(Number(prop)) && Number(prop) >= 0) {\n\t\t\t\trepeatListInstance.push(tempPreExistingData[prop]);\n\t\t\t} else {\n\t\t\t\tif (typeof repeatListInstance[prop] === 'undefined' || repeatListInstance[prop] === null) {\n\t\t\t\t\trepeatListInstance[prop] = tempPreExistingData[prop];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t// --- jQuery Plugin Methods ---\n\n\t$.fn.scopeGetEl = function() {\n\t\treturn this.closest('[jq-repeat-scope]');\n\t};\n\n\t$.fn.scopeGet = function() {\n\t\tlet $el = this.scopeGetEl();\n\t\tif ($el && $el.attr('jq-repeat-scope')) {\n\t\t\treturn $.scope[$el.attr('jq-repeat-scope')];\n\t\t}\n\t\treturn undefined;\n\t};\n\n\t\t\t$.fn.scopeItem = function() {\n\t\tlet $el = this.scopeGetEl();\n\t\tif ($el) {\n\t\t\tconst scopeId = $el.attr('jq-repeat-scope');\n\t\t\tconst indexOrId = $el.attr('jq-repeat-index');\n\t\t\tconst scopeInstance = $.scope[scopeId];\n\n\t\t\tif (scopeInstance) {\n\t\t\t\tif (scopeInstance.__jqIndexKey) {\n\t\t\t\t\treturn scopeInstance.getByKey(scopeInstance.__jqIndexKey, indexOrId);\n\t\t\t\t} else {\n\t\t\t\t\treturn scopeInstance[Number(indexOrId)];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t};\n\n\t$.fn.scopeItemUpdate = function(data) {\n\t\tlet $el = this.scopeGetEl();\n\t\tif ($el) {\n\t\t\tconst scopeId = $el.attr('jq-repeat-scope');\n\t\t\tconst indexOrId = $el.attr('jq-repeat-index');\n\t\t\tconst scopeInstance = $.scope[scopeId];\n\n\t\t\tif (scopeInstance) {\n\t\t\t\tif (scopeInstance.__jqIndexKey) {\n\t\t\t\t\tscopeInstance.update(scopeInstance.__jqIndexKey, indexOrId, data);\n\t\t\t\t} else {\n\t\t\t\t\tscopeInstance.update(Number(indexOrId), data);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t$.fn.scopeItemRemove = function() {\n\t\tlet $el = this.scopeGetEl();\n\t\tif ($el) {\n\t\t\tconst scopeId = $el.attr('jq-repeat-scope');\n\t\t\tconst indexOrId = $el.attr('jq-repeat-index');\n\t\t\tconst scopeInstance = $.scope[scopeId];\n\n\t\t\tif (scopeInstance) {\n\t\t\t\tif (scopeInstance.__jqIndexKey) {\n\t\t\t\t\tscopeInstance.remove(indexOrId);\n\t\t\t\t} else {\n\t\t\t\t\tscopeInstance.remove(Number(indexOrId));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t// --- Document Ready and MutationObserver for Auto-Initialization ---\n\n\t$(document).ready(function() {\n\t\tconst observer = new MutationObserver(function(mutationsList) {\n\t\t\tmutationsList.forEach(mutation => {\n\t\t\t\tif (mutation.type === 'childList') {\n\t\t\t\t\tconst addedNodes = mutation.addedNodes;\n\t\t\t\t\taddedNodes.forEach(node => {\n\t\t\t\t\t\tif (node.nodeType === Node.ELEMENT_NODE) {\n\t\t\t\t\t\t\t// Check if the added node itself is a jq-repeat\n\t\t\t\t\t\t\tif (node.hasAttribute(\"jq-repeat\")) {\n\t\t\t\t\t\t\t\tconst scopeId = $(node).attr('jq-repeat');\n\t\t\t\t\t\t\t\tmake($(node));\n\t\t\t\t\t\t\t\tif (scopeId && $.scope[scopeId]) {\n\t\t\t\t\t\t\t\t\t_scope.onNew.call($.scope[scopeId]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Check if any of its descendants are jq-repeat\n\t\t\t\t\t\t\t\tconst foundRepeats = node.querySelectorAll(\"[jq-repeat]\");\n\t\t\t\t\t\t\t\tif (foundRepeats.length > 0) {\n\t\t\t\t\t\t\t\t\tfoundRepeats.forEach(foundNode => {\n\t\t\t\t\t\t\t\t\t\tconst scopeId = $(foundNode).attr('jq-repeat');\n\t\t\t\t\t\t\t\t\t\tmake($(foundNode));\n\t\t\t\t\t\t\t\t\t\tif (scopeId && $.scope[scopeId]) {\n\t\t\t\t\t\t\t\t\t\t\t_scope.onNew.call($.scope[scopeId]);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tobserver.observe(document.body, {\n\t\t\tchildList: true,\n\t\t\tsubtree: true\n\t\t});\n\n\t\t// Initialize any jq-repeat elements already present in the DOM on load\n\t\t$('[jq-repeat]').each(function(key, value) {\n\t\t\tif ($(value).closest('body').length !== 0) {\n\t\t\t\tconst scopeId = $(value).attr('jq-repeat');\n\t\t\t\tmake($(value));\n\t\t\t\tif (scopeId && $.scope[scopeId]) {\n\t\t\t\t\t_scope.onNew.call($.scope[scopeId]);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n\n})(jQuery, Mustache);\n"],"names":["CallbackQueue","constructor","callbacks","this","__callbacks","callback","Array","isArray","push","Function","call","args","arguments","forEach","$","Mustache","throttleMap","throttleCheck","key","callBack","setTimeout","minDelay","_scope","cleanupNestedRepeats","$element","length","find","each","nestedScopeId","attr","scope","nestedInstance","i","__jq_$el","__take","Object","defineProperty","value","writable","enumerable","configurable","Proxy","get","obj","prop","Reflect","set","RepeatList","Symbol","species","element","scopeId","options","parentData","parentId","parentIndex","templateHTML","nestedTemplates","super","__jqRepeatId","undefined","indexKey","__jqIndexKey","orderBy","__jqOrderBy","__jqOrderReverse","orderReverse","_parentData","__jqParent","__jqParentIndex","__jqTemplate","$this","replaceWith","tokenArray","parse","templateKeys","token","includes","templateKeysObj","__parseTemplateKeys","parseKeys","console","warn","keyMap","type","keyParts","split","currentMap","part","index","cleanPart","__compareItems","itemA","itemB","valA","valB","comparison","localeCompare","sensitivity","Date","getTime","String","__findInsertionIndex","newItem","splice","inputValue","wasIndexLookup","indexOf","numericInput","Number","isNaN","Math","max","howMany","toAdd","slice","min","removedItems","item","nativeSpliceResult","previousElement","newItemData","renderData","__buildData","$render","render","addClass","hasOwnProperty","after","__put","insertionIndex","pop","reverse","detachedElements","detach","elementsToReverse","lastElement","remove","keyOrValue","empty","shift","unshift","valueToMatch","searchKey","searchValue","error","update","keyOrIndex","valueOrData","dataToUpdate","data","throttle","__updateDom","bind","originalItemData","originalDOMEl","extend","itemToMove","newInsertionIndex","__putUpdate","getByKey","$el","list","show","__parseData","parsedData","keys","actualParentIndex","__parseNestedTemplates","_parent","_index","_list","_actualParentIndex","templates","idx","outerHTML","make","attributes","name","startsWith","optionName","replace","g","toUpperCase","parentElement","parent","closest","el","templateIdx","template","removeAttr","repeatListInstance","tempPreExistingData","isInteger","fn","scopeGetEl","scopeGet","scopeItem","indexOrId","scopeInstance","scopeItemUpdate","scopeItemRemove","document","ready","MutationObserver","mutationsList","mutation","addedNodes","node","nodeType","Node","ELEMENT_NODE","hasAttribute","onNew","foundRepeats","querySelectorAll","foundNode","observe","body","childList","subtree","jQuery"],"mappings":";yBAMA,MAAMA,EACL,WAAAC,CAAYC,GACXC,KAAKC,YAAc,GAEnB,IAAK,IAAIC,KAAYC,MAAMC,QAAQL,GAAaA,EAAY,CAACA,GAC5DC,KAAKK,KAAKH,EAEZ,CAEA,IAAAG,CAAKH,GACAA,aAAoBI,UACvBN,KAAKC,YAAYI,KAAKH,EAExB,CAEA,IAAAK,GACC,IAAIC,EAAOC,UACXT,KAAKC,YAAYS,QAAQR,IACxBA,KAAYM,IAEd,GAID,SAAUG,EAAGC,GAGZ,MAAMC,EAAc,CAAA,EAEpB,SAASC,EAAcC,GACfF,EAAYE,IAAkC,OAA1BF,EAAYE,GAAKP,MAErCK,EAAYE,GAAKC,YAAYH,EAAYE,GAAKP,MAC9CK,EAAYE,GAAKP,KAAO,KAGxBS,WAAWH,EAAeD,EAAYE,GAAKG,SAAUH,WAG9CF,EAAYE,EAE3B,CAuBA,MAAMI,EAAS,CAAA,EAsBf,SAASC,EAAqBC,GAC7B,IAAKA,IAAaA,EAASC,OAAQ,OAGZD,EAASE,KAAK,qBAEtBC,KAAK,WACnB,MACMC,EADUd,EAAEX,MACY0B,KAAK,mBAEnC,GAAID,GAAiBd,EAAEgB,MAAMF,GAAgB,CAE5C,MAAMG,EAAiBjB,EAAEgB,MAAMF,GAG/B,IAAK,IAAII,EAAI,EAAGA,EAAID,EAAeN,OAAQO,IACtCD,EAAeC,IAAMD,EAAeC,GAAGC,UAC1CF,EAAeG,OAAOH,EAAeC,GAAGC,SAAUF,EAAeC,GAAID,GAKvEA,EAAeN,OAAS,SAGjBX,EAAEgB,MAAMF,EAChB,CACD,EACD,CAhDAO,OAAOC,eAAed,EAAQ,QAAS,CACtCe,MAAO,IAAIrC,EACXsC,UAAU,EACVC,YAAY,EACZC,cAAc,IAGf1B,EAAEgB,MAAQ,IAAIW,MAAMnB,EAAQ,CAC3B,GAAAoB,CAAIC,EAAKC,GAIR,OAHKD,EAAIC,KACRD,EAAIC,GAAQ,IAENC,QAAQH,OAAO9B,UACvB,EACA,GAAAkC,CAAIH,EAAKC,EAAMP,GACd,OAAOQ,QAAQC,OAAOlC,UACvB,IAmCD,MAAMmC,UAAmBzC,MAGxB,WAAY0C,OAAOC,WAClB,OAAO3C,KACR,CAEA,WAAAL,CAAYiD,EAASC,EAASC,EAASC,EAAYC,EAAUC,EAAaC,EAAcC,GACvFC,QAEAvD,KAAKwD,aAAeR,EACpBhD,KAAKiD,QAAUA,EAGXA,QAAgCQ,IAArBR,EAAQS,WACtB1D,KAAK2D,aAAeV,EAAQS,UAIzBT,QAA+BQ,IAApBR,EAAQW,SACtB5D,KAAK6D,YAAcZ,EAAQW,QAC3B5D,KAAK8D,iBAA4C,SAAzBb,EAAQc,eAEhC/D,KAAK6D,YAAc,KACnB7D,KAAK8D,kBAAmB,GAGzB9D,KAAKgE,YAAcd,EACnBlD,KAAKiE,WAAad,EAClBnD,KAAKkE,gBAAkBd,EACvBpD,KAAKmE,aAAed,EACpBrD,KAAKsD,gBAAkBA,EAEvBtD,KAAKoE,MAAQzD,EAAE,uDAAuDX,KAAKwD,4BAC3E7C,EAAEoC,GAASsB,YAAYrE,KAAKoE,OAE5B,IAAIE,EAAa1D,EAAS2D,MAAMvE,KAAKmE,cAErCnE,KAAKwE,aAAe,GAEpB,IAAI,IAAIC,KAASH,EACb,CAAC,OAAQ,IAAK,KAAKI,SAASD,EAAM,KACpCzE,KAAKwE,aAAanE,KAAKoE,EAAM,IAI/BzE,KAAK2E,gBAAkB3E,KAAK4E,oBAAoBN,GAEhDtE,KAAK6E,UAAY,CAAA,EAEjB,IAAK,IAAIpC,IAAQ,CAAC,MAAO,OAAQ,YAAa,aAC7CT,OAAOC,eAAejC,KAAMyC,EAAM,CACjCL,YAAY,EACZ,GAAAG,GACC,OAAOvC,KAAK,KAAKyC,IAClB,EACA,GAAAE,CAAIT,GACkB,mBAAVA,EACVlC,KAAK,KAAKyC,KAAUP,EAEpB4C,QAAQC,KAAK,gCAAgCtC,yCAA4CzC,KAAKwD,iBAEhG,GAGH,CAiBD,mBAAAoB,CAAoBN,GACnB,MAAMU,EAAS,CAAA,EAsCf,OApCAV,EAAW5D,QAAQ+D,IACnB,MAAMQ,EAAOR,EAAM,GACb1D,EAAM0D,EAAM,GAGlB,GAAI,CAAC,OAAQ,IAAK,IAAK,IAAK,KAAKC,SAASO,GAAO,CAE/C,MAAMC,EAAWnE,EAAIoE,MAAM,KAC3B,IAAIC,EAAaJ,EAEjBE,EAASxE,QAAQ,CAAC2E,EAAMC,KAEtB,MAAMC,EAAYF,EAAKF,MAAM,KAAK,GAE9BG,IAAUJ,EAAS5D,OAAS,EAI5B8D,EAAWG,GAFA,MAATN,GAAyB,MAATA,EAEMjF,KAAK4E,oBAAoBH,EAAM,IAG/B,MAKrBW,EAAWG,IAA+C,iBAA1BH,EAAWG,KAC9CH,EAAWG,GAAa,CAAA,GAG1BH,EAAaA,EAAWG,KAG9B,IAGOP,CACR,CAMC,cAAAQ,CAAeC,EAAOC,GACrB,IAAK1F,KAAK6D,YACT,OAAO,EAGR,GAAI6B,QACA,OAAO,EAGX,MAAMC,EAAOF,EAAMzF,KAAK6D,aAClB+B,EAAOF,EAAM1F,KAAK6D,aAGxB,GAAI8B,QAAqC,OAAO,MAACC,EAAuC,EAAK5F,KAAK8D,kBAAmB,EAAK,EAC1H,GAAI8B,QAAqC,OAAQ5F,KAAK8D,iBAAmB,GAAI,EAE7E,IAAI+B,EAAa,EAkBjB,OAdCA,EADmB,iBAATF,GAAqC,iBAATC,EACzBD,EAAOC,EAGI,iBAATD,GAAqC,iBAATC,EAC9BD,EAAKG,cAAcF,OAAMnC,EAAW,CAAEsC,YAAa,SAGxDJ,aAAgBK,MAAQJ,aAAgBI,KACnCL,EAAKM,UAAYL,EAAKK,UAGtBC,OAAOP,GAAMG,cAAcI,OAAON,QAAOnC,EAAW,CAAEsC,YAAa,SAG1E/F,KAAK8D,kBAAoB+B,EAAaA,CAC9C,CAKA,oBAAAM,CAAqBC,GACjB,IAAKpG,KAAK6D,YACN,OAAO7D,KAAKsB,OAGhB,IAAK,IAAIO,EAAI,EAAGA,EAAI7B,KAAKsB,OAAQO,IAC7B,QAAgB4B,IAAZzD,KAAK6B,IAAgC,OAAZ7B,KAAK6B,IAIlC,GAAI7B,KAAKwF,eAAeY,EAASpG,KAAK6B,IAAM,EACxC,OAAOA,OAJPiD,QAAQC,KAAK,6DAA6DlD,6BAA6B7B,KAAKwD,sCAOpH,OAAOxD,KAAKsB,MAChB,CAEA,MAAA+E,CAAOC,KAAe9F,GACrB,IAAI8E,EACAiB,GAAiB,EAGrB,GAA0B,iBAAfD,GAA2BtG,KAAK2D,cAG1C,GAFA2B,EAAQtF,KAAKwG,QAAQF,GACrBC,GAAiB,GACH,IAAVjB,EAAc,CACjB,IAAImB,EAAeC,OAAOJ,GAC1B,IAAKK,MAAMF,IAAiBA,GAAgB,GAAKA,EAAezG,KAAKsB,OACpEgE,EAAQmB,EACRF,GAAiB,MACX,CACN,KAAgB,IAAZ/F,EAAK,IAAYA,EAAKc,OAAS,GAIlC,MAAO,GAHPgE,EAAQsB,KAAKC,IAAI,EAAGJ,GACpBF,GAAiB,CAInB,CACD,MAE0B,iBAAfD,EACVhB,EAAQgB,GAERhB,EAAQtF,KAAKwG,QAAQF,GACrBC,GAAiB,GAMnB,GAAIA,IAA4B,IAAVjB,IAAiB9E,EAAK,GAAK,GAAqB,IAAhBA,EAAKc,QAC1D,MAAO,GAGR,IAAIwF,EAAUtG,EAAK,IAAOR,KAAKsB,OAASgE,EACpCyB,EAAQvG,EAAKwG,MAAM,GAGnB1B,EAAQtF,KAAKsB,SAAQgE,EAAQtF,KAAKsB,QAClCgE,EAAQ,IAAGA,EAAQsB,KAAKC,IAAI,EAAG7G,KAAKsB,OAASgE,IACjDwB,EAAUF,KAAKK,IAAIH,EAAS9G,KAAKsB,OAASgE,GAE1C,IAAI4B,EAAelH,KAAKgH,MAAM1B,EAAOA,EAAQwB,GAG7C,IAAK,IAAIjF,EAAI,EAAGA,EAAIqF,EAAa5F,OAAQO,IAAK,CAC7C,IAAIsF,EAAOD,EAAarF,GACpBsF,GAAQA,EAAKrF,WAEhBV,EAAqB+F,EAAKrF,UAC1B9B,KAAK+B,OAAOoF,EAAKrF,SAAUqF,EAAMnH,MAEnC,CAGA,MAAMoH,EAAqB7D,MAAM8C,OAAOf,EAAOwB,KAAYC,GAG3D,GAAIA,EAAMzF,OAAS,EAAG,CACrB,IAAI+F,EAAkB,KAErBA,EADG/B,EAAQ,GAAKtF,KAAKsF,EAAQ,IAAMtF,KAAKsF,EAAQ,GAAGxD,SACjC9B,KAAKsF,EAAQ,GAAGxD,SAEhB9B,KAAKoE,MAGxB,IAAK,IAAIvC,EAAI,EAAGA,EAAIkF,EAAMzF,OAAQO,IAAK,CACtC,IAAIyF,EAAcP,EAAMlF,GACpB0F,EAAavH,KAAKwH,YAAYlC,EAAQzD,EAAGyF,GACzCG,EAAU9G,EAAEC,EAAS8G,OAAO1H,KAAKmE,aAAcoD,IACjDI,SAAS,aAAe3H,KAAKwD,cAC7B9B,KAAK,kBAAmB1B,KAAKwD,cAE3BxD,KAAK2D,cAAgB2D,EAAYM,eAAe5H,KAAK2D,cACxD8D,EAAQ/F,KAAK,kBAAmB4F,EAAYtH,KAAK2D,eAEjD8D,EAAQ/F,KAAK,kBAAmB4D,EAAQzD,GAGrCwF,GAAmBA,EAAgB/F,OACtC+F,EAAgBQ,MAAMJ,GAEtBzH,KAAKoE,MAAMyD,MAAMJ,GAElBJ,EAAkBI,EAElBzF,OAAOC,eAAeqF,EAAa,WAAY,CAC9CpF,MAAOuF,EACPtF,UAAU,EACVC,YAAY,EACZC,cAAc,IAGfrC,KAAK8H,MAAML,EAASH,EAAatH,KAClC,CACD,CAGA,IAAK,IAAI6B,EAAIyD,EAAOzD,EAAI7B,KAAKsB,OAAQO,IAChC7B,KAAK6B,IAAM7B,KAAK6B,GAAGC,WAClB9B,KAAK2D,cAAgB3D,KAAK6B,GAAG+F,eAAe5H,KAAK2D,cACpD3D,KAAK6B,GAAGC,SAASJ,KAAK,kBAAmB1B,KAAK6B,GAAG7B,KAAK2D,eAEtD3D,KAAK6B,GAAGC,SAASJ,KAAK,kBAAmBG,GAE1C7B,KAAK6B,GAAGC,SAASJ,KAAK,kBAAmB1B,KAAKwD,eAIhD,OAAO4D,CACR,CAEA,IAAA/G,IAAQG,GACP,IAAKR,KAAK6D,YAAa,CACtB,MAAMyB,EAAQtF,KAAKsB,QAAU,EAC7B,OAAOtB,KAAKqG,OAAOf,EAAO,KAAM9E,EACjC,CAEA,IAAK,IAAIqB,EAAI,EAAGA,EAAIrB,EAAKc,SAAUO,EAAG,CACrC,MAAMuE,EAAU5F,EAAKqB,GACfkG,EAAiB/H,KAAKmG,qBAAqBC,GACjDpG,KAAKqG,OAAO0B,EAAgB,EAAG3B,EAChC,CACA,OAAOpG,KAAKsB,MACb,CAEA,GAAA0G,GACC,OAAOhI,KAAKqG,QAAO,EAAI,GAAG,EAC3B,CAEA,OAAA4B,GACC,GAAKjI,KAAK6D,YAyBH,CACNiB,QAAQC,KAAK,yIAEb,IAAImD,EAAmB,GACvB,IAAK,IAAIrG,EAAI,EAAGA,EAAI7B,KAAKsB,OAAQO,IAC5B7B,KAAK6B,IAAM7B,KAAK6B,GAAGC,UACtBoG,EAAiB7H,KAAKL,KAAK6B,GAAGC,SAASqG,UAIzC5E,MAAM0E,UAEN,IAAIZ,EAAkBrH,KAAKoE,MAC3B,IAAK,IAAIvC,EAAI,EAAGA,EAAI7B,KAAKsB,OAAQO,IAAK,CACrC,MAAMsF,EAAOnH,KAAK6B,GAClB,GAAIsF,GAAQA,EAAKrF,SAAU,CAC1B,MAAMyF,EAAavH,KAAKwH,YAAY3F,EAAGsF,GACjCM,EAAU9G,EAAEC,EAAS8G,OAAO1H,KAAKmE,aAAcoD,IACnDI,SAAS,aAAe3H,KAAKwD,cAC7B9B,KAAK,kBAAmB1B,KAAKwD,cAE3BxD,KAAK2D,cAAgBwD,EAAKS,eAAe5H,KAAK2D,cACjD8D,EAAQ/F,KAAK,kBAAmByF,EAAKnH,KAAK2D,eAE1C8D,EAAQ/F,KAAK,kBAAmBG,GAGjCwF,EAAgBQ,MAAMJ,GACtBzF,OAAOC,eAAekF,EAAM,WAAY,CACvCjF,MAAOuF,EACPtF,UAAU,EACVC,YAAY,EACZC,cAAc,IAEfgF,EAAkBI,CACnB,CACD,CACD,KA9DuB,CACtB,IAAIW,EAAoB,GACxB,IAAK,IAAIvG,EAAI,EAAGA,EAAI7B,KAAKsB,OAAQO,IAC5B7B,KAAK6B,IAAM7B,KAAK6B,GAAGC,UACtBsG,EAAkB/H,KAAKL,KAAK6B,GAAGC,SAASqG,UAI1CC,EAAkBH,UAElB,IAAII,EAAcrI,KAAKoE,MACvB,IAAK,IAAIvC,EAAI,EAAGA,EAAIuG,EAAkB9G,OAAQO,IAC7CwG,EAAYR,MAAMO,EAAkBvG,IACpCwG,EAAcD,EAAkBvG,GAGjC0B,MAAM0E,UAEN,IAAK,IAAIpG,EAAI,EAAGA,EAAI7B,KAAKsB,OAAQO,IAC5B7B,KAAK6B,IAAM7B,KAAK6B,GAAGC,WACjB9B,KAAK2D,cACT3D,KAAK6B,GAAGC,SAASJ,KAAK,kBAAmBG,GAI7C,CAsCA,OAAO7B,IACR,CAEA,MAAAsI,CAAOC,EAAYrG,GAClB,IAAIoD,EAEHA,EADwB,IAArB7E,UAAUa,OACLtB,KAAKwG,QAAQ+B,GAEbvI,KAAKwG,QAAQ+B,EAAYrG,IAGpB,IAAVoD,GACJtF,KAAKqG,OAAOf,EAAO,EACpB,CAEA,KAAAkD,GACC,OAAOxI,KAAKqG,OAAO,EAAGrG,KAAKsB,OAC5B,CAEA,KAAAmH,GACC,OAAOzI,KAAKqG,OAAO,EAAG,GAAG,EAC1B,CAEA,OAAAqC,IAAWlI,GACV,IAAKR,KAAK6D,YACT,OAAO7D,KAAKqG,OAAO,EAAG,KAAM7F,GAG7B,IAAK,IAAIqB,EAAIrB,EAAKc,OAAS,EAAGO,GAAK,IAAKA,EAAG,CAC1C,MAAMuE,EAAU5F,EAAKqB,GACfkG,EAAiB/H,KAAKmG,qBAAqBC,GACjDpG,KAAKqG,OAAO0B,EAAgB,EAAG3B,EAChC,CACA,OAAOpG,KAAKsB,MACb,CAKA,OAAAkF,CAAQ+B,EAAYI,GACnB,GAA0B,iBAAfJ,EACV,OAAIA,GAAc,GAAKA,EAAavI,KAAKsB,OACjCiH,GAED,EAGR,IAAIK,EACAC,EAEJ,GAAyB,IAArBpI,UAAUa,OACbsH,EAAYL,EACZM,EAAcF,MACR,IAAyB,IAArBlI,UAAUa,OAmBpB,OADAwD,QAAQgE,MAAM,mDAAoDrI,YAC3D,EAlBP,GAA0B,iBAAf8H,GAA0C,OAAfA,EAAqB,CAC1D,IAAK,IAAI1G,EAAI,EAAGA,EAAI7B,KAAKsB,SAAUO,EAClC,GAAI7B,KAAK6B,KAAO0G,EACf,OAAO1G,EAGT,OAAO,CACR,CAIC,GAHA+G,EAAY5I,KAAK2D,aACjBkF,EAAcN,GAETK,EAEJ,OADA9D,QAAQC,KAAK,4GAA4G/E,KAAKwD,mBACvH,CAMV,CAEA,IAAK,IAAI3B,EAAI,EAAGA,EAAI7B,KAAKsB,SAAUO,EAClC,GAAI7B,KAAK6B,IAAM7B,KAAK6B,GAAG+F,eAAegB,IAAc5I,KAAK6B,GAAG+G,KAAeC,EAC1E,OAAOhH,EAGT,OAAO,CACR,CAGA,MAAAkH,CAAOC,EAAYC,EAAaC,GAC5B,IAAI5D,EACA6D,EAEJ,GAA0B,iBAAfH,QAA2CvF,IAAhBwF,QAA8CxF,IAAjByF,EAA4B,CAC3F,KAAIlJ,KAAKsB,OAAS,GAKd,OADAwD,QAAQC,KAAK,qDAAqD/E,KAAKwD,+CAChExD,KAAKK,KAAK2I,GAJjB1D,EAAQ,EACR6D,EAAOH,CAKf,MAAO,GAA0B,iBAAfA,GAAkD,iBAAhBC,EAChD3D,EAAQ0D,EACRG,EAAOF,OACJ,GAA0B,iBAAfD,GAAkD,iBAAhBC,GAAoD,iBAAjBC,EACnF5D,EAAQtF,KAAKwG,QAAQwC,EAAYC,GACjCE,EAAOD,MACJ,IAA0B,iBAAfF,GAAkD,iBAAhBC,QAA6CxF,IAAjByF,EAK5E,OADApE,QAAQgE,MAAM,kDAAmDrI,WAC1D,KAJP6E,EAAQtF,KAAKwG,QAAQwC,GACrBG,EAAOF,CAIX,CAEA,IAAc,IAAV3D,GAAgBA,GAAStF,KAAKsB,OAE9B,OADAwD,QAAQC,KAAK,+CAA+CO,qDAAyDtF,KAAKwD,kBACnH,KAGX,IAAKxD,KAAKsF,GAEN,OADAR,QAAQC,KAAK,uCAAuCO,qCAAyCtF,KAAKwD,iCAC3F,KAMX,OAnkBL,SAAkBzC,EAAKG,EAAUF,KAAaR,GACtCK,EAAYE,GAEZF,EAAYE,GAAKP,KAAOA,GAGxBK,EAAYE,GAAO,CACfP,KAAM,KACNU,WACAF,YAIJA,KAAYR,GAGZS,WAAWH,EAAeI,EAAUH,GAE5C,CAijBYqI,CAHapJ,KAAKwD,aAAe,IAAM8B,EAGjB,GAFNtF,KAAKqJ,YAAYC,KAAKtJ,MAEIsF,EAAO6D,EAC5D,CAEA,WAAAE,CAAY/D,EAAO6D,GAClB,IAAII,EAAmB,KACnBC,EAAgB,KAEX,IAAKxJ,KAAKsF,GAAOxD,SAEb,OADAgD,QAAQC,KAAK,4BAA4BO,oFAAwFtF,KAAKwD,kBAC/H,KAapB,GAVA+F,EAAmB5I,EAAE8I,QAAO,EAAM,CAAA,EAAIzJ,KAAKsF,IAC3CkE,EAAgBxJ,KAAKsF,GAAOxD,SAG5BV,EAAqBoI,GAGrBxJ,KAAKsF,GAAS3E,EAAE8I,QAAO,EAAMzJ,KAAKsF,GAAQ6D,GAGtCnJ,KAAK6D,aAEmD,IAAvD7D,KAAKwF,eAAe+D,EAAkBvJ,KAAKsF,IAAe,CAC7D,MAAMoE,EAAa1J,KAAKsF,GAGpBkE,GAAiBA,EAAclI,QAClCtB,KAAK+B,OAAOyH,EAAeE,EAAY1J,MAExCuD,MAAM8C,OAAOf,EAAO,GAGpB,MAAMqE,EAAoB3J,KAAKmG,qBAAqBuD,GACpDnG,MAAM8C,OAAOsD,EAAmB,EAAGD,GAGnC,MAAMnC,EAAavH,KAAKwH,YAAYmC,EAAmBD,GACjDjC,EAAU9G,EAAEC,EAAS8G,OAAO1H,KAAKmE,aAAcoD,IACnDI,SAAS,aAAe3H,KAAKwD,cAC7B9B,KAAK,kBAAmB1B,KAAKwD,cAE3BxD,KAAK2D,cAAgB+F,EAAW9B,eAAe5H,KAAK2D,cACvD8D,EAAQ/F,KAAK,kBAAmBgI,EAAW1J,KAAK2D,eAEhD8D,EAAQ/F,KAAK,kBAAmBiI,GAGjC,IAAItC,EAAkB,KAErBA,EADGsC,EAAoB,GAAK3J,KAAK2J,EAAoB,IAAM3J,KAAK2J,EAAoB,GAAG7H,SACrE9B,KAAK2J,EAAoB,GAAG7H,SAE5B9B,KAAKoE,MAGpBiD,GAAmBA,EAAgB/F,OACtC+F,EAAgBQ,MAAMJ,GAEtBzH,KAAKoE,MAAMyD,MAAMJ,GAGlBzF,OAAOC,eAAeyH,EAAY,WAAY,CAC7CxH,MAAOuF,EACPtF,UAAU,EACVC,YAAY,EACZC,cAAc,IAGfrC,KAAK8H,MAAML,EAASiC,EAAY1J,MAGhC,IAAK,IAAI6B,EAAI,EAAGA,EAAI7B,KAAKsB,OAAQO,IAC5B7B,KAAK6B,IAAM7B,KAAK6B,GAAGC,WAAa9B,KAAK2D,cACxC3D,KAAK6B,GAAGC,SAASJ,KAAK,kBAAmBG,GAI3C,OAAO4F,CACR,CAID,MAAMF,EAAavH,KAAKwH,YAAYlC,EAAOtF,KAAKsF,IAC1CmC,EAAU9G,EAAEC,EAAS8G,OAAO1H,KAAKmE,aAAcoD,IAarD,OAXAE,EAAQ/F,KAAK,kBAAmB1B,KAAKwD,cACjCxD,KAAK2D,cAAgB3D,KAAKsF,GAAOsC,eAAe5H,KAAK2D,cACxD8D,EAAQ/F,KAAK,kBAAmB1B,KAAKsF,GAAOtF,KAAK2D,eAEjD8D,EAAQ/F,KAAK,kBAAmB4D,GAEjCmC,EAAQE,SAAS,aAAa3H,KAAKwD,gBAEnCxD,KAAK4J,YAAYJ,EAAe/B,EAASzH,KAAKsF,GAAQtF,MAEtDA,KAAKsF,GAAOxD,SAAW2F,EAChBA,CACR,CAEA,QAAAoC,IAAYrJ,GACX,OAAOR,KAAKA,KAAKwG,WAAWhG,GAC7B,CAIA,KAAAsH,CAAMgC,EAAK3C,EAAM4C,GAChBD,EAAIE,MACL,CAEA,MAAAjI,CAAO+H,EAAK3C,EAAM4C,GACbD,GAAOA,EAAIxI,QACdwI,EAAIxB,SAEDnB,IACHA,EAAKrF,SAAW,KAElB,CAEA,WAAA8H,CAAYE,EAAKrC,EAASN,EAAM4C,GAC/BtC,EAAQuC,OACRF,EAAIzF,YAAYoD,EACjB,CAEA,WAAAwC,CAAYd,GACX,IAAIe,EAAa,IAAKf,GACtB,IAAK,IAAIpI,KAAOiB,OAAOmI,KAAKD,GACvBlK,KAAK6E,UAAU9D,KAClBmJ,EAAWnJ,GAAOf,KAAK6E,UAAU9D,GAAKmJ,EAAWnJ,GAAMA,EAAKmJ,IAG9D,OAAOA,CACR,CAIA,WAAA1C,CAAYlC,EAAO6D,GAClB,MAAMiB,EAAoBpK,KAAKkE,gBAC/B,MAAO,IACHlE,KAAKiK,YAAYd,GACpB7F,gBAAiBtD,KAAKqK,uBAAuB/E,EAAO6D,GACpDmB,QAAStK,KAAKgE,YACduG,OAAQjF,EACRkF,MAAOxK,KACPyK,mBAAoBL,EAEtB,CAEA,sBAAAC,CAAuB/E,EAAO6D,GAC7B,IAAIuB,EAAY,GAMhB,IAAK,IAAIC,KAAO3K,KAAKsD,gBAAiB,CACrC,IAAIwG,EAAMnJ,EAAE,GAAGX,KAAKsD,gBAAgBqH,MAEpCb,EAAIpI,KAAK,mBAAoB1B,KAAKwD,cAClCsG,EAAIpI,KAAK,yBAA0B1B,KAAKkE,iBACxCwG,EAAUC,GAAOb,EAAI,GAAGc,SACzB,CACA,OAAOF,CACR,EAGD,IAAIG,EAAO,SAAS9H,GACnB,MAAMqB,EAAQzD,EAAEoC,GAEVC,EAAUoB,EAAM1C,KAAK,aAC3B,IAAKsB,EAEJ,YADA8B,QAAQgE,MAAM,oDAAqD/F,GAIpE,MAAME,EAAU,CAAA,EAChBtC,EAAEa,KAAK4C,EAAM,GAAG0G,WAAY,WAC3B,GAAI9K,KAAK+K,KAAKC,WAAW,QAAUhL,KAAK+K,KAAKC,WAAW,OAAQ,CAC/D,MAAMC,EAAajL,KAAK+K,KAAKG,QAAQ,aAAc,IAAIA,QAAQ,YAAcC,GAAMA,EAAE,GAAGC,eACxFnI,EAAQgI,GAAcjL,KAAKkC,KAC5B,CACD,GAGA,IAAIgB,EAAa,KACbC,EAAW,KACXC,EAAc,KAClB,GAAIgB,EAAM1C,KAAK,oBAAqB,CACnCyB,EAAWiB,EAAM1C,KAAK,oBACtB,MAAM2J,EAAgBjH,EAAMkH,SAASC,QAAQ,qBAAqBpI,OAC9DkI,EAAc/J,QACjB8B,EAAciI,EAAc3J,KAAK,mBAC7Bf,EAAEgB,MAAMwB,IAAaxC,EAAEgB,MAAMwB,GAAUQ,cAAgBhD,EAAEgB,MAAMwB,GAAU0G,SAASlJ,EAAEgB,MAAMwB,GAAUQ,aAAcP,GACrHF,EAAavC,EAAEgB,MAAMwB,GAAU0G,SAASlJ,EAAEgB,MAAMwB,GAAUQ,aAAcP,IAC9DzC,EAAEgB,MAAMwB,IAAcxC,EAAEgB,MAAMwB,GAAUQ,cAAiBgD,MAAMD,OAAOtD,IAIhF0B,QAAQC,KAAK,4BAA4B5B,6BAAoCC,oCAH7EF,EAAavC,EAAEgB,MAAMwB,GAAUuD,OAAOtD,KAMvC0B,QAAQC,KAAK,uDAAuD5B,MAEtE,CAGA,MAAMG,EAAkB,GACxBc,EAAM7C,KAAK,eAAeC,KAAK,CAACmJ,EAAKa,KACpC,IAAIC,EAAcnI,EAAgBhC,OAC9BoK,EAAW,GAAGF,EAAGZ,YACrBtH,EAAgBjD,KAAKqL,GAEpB/K,EAAE6K,GAAInH,YAAY,uBAAuBoH,WAG3CrH,EAAMuH,WAAW,aAEjB,MAAMtI,EAAee,EAAM,GAAGwG,UAExBgB,EAAqB,IAAIhJ,EAC9BG,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,GAGKuI,EAAsB1K,EAAO6B,IAAY,GAC/C7B,EAAO6B,GAAW4I,EAGlB,IAAK,MAAMnJ,KAAQT,OAAOmI,KAAK0B,GAC1BnF,OAAOoF,UAAUpF,OAAOjE,KAAUiE,OAAOjE,IAAS,EACrDmJ,EAAmBvL,KAAKwL,EAAoBpJ,SAEJ,IAA7BmJ,EAAmBnJ,IAAsD,OAA7BmJ,EAAmBnJ,KACzEmJ,EAAmBnJ,GAAQoJ,EAAoBpJ,GAInD,EAIA9B,EAAEoL,GAAGC,WAAa,WACjB,OAAOhM,KAAKuL,QAAQ,oBACrB,EAEA5K,EAAEoL,GAAGE,SAAW,WACf,IAAInC,EAAM9J,KAAKgM,aACf,GAAIlC,GAAOA,EAAIpI,KAAK,mBACnB,OAAOf,EAAEgB,MAAMmI,EAAIpI,KAAK,mBAG1B,EAEEf,EAAEoL,GAAGG,UAAY,WAClB,IAAIpC,EAAM9J,KAAKgM,aACf,GAAIlC,EAAK,CACR,MAAM9G,EAAU8G,EAAIpI,KAAK,mBACnByK,EAAYrC,EAAIpI,KAAK,mBACrB0K,EAAgBzL,EAAEgB,MAAMqB,GAE9B,GAAIoJ,EACH,OAAIA,EAAczI,aACVyI,EAAcvC,SAASuC,EAAczI,aAAcwI,GAEnDC,EAAc1F,OAAOyF,GAG/B,CAED,EAEAxL,EAAEoL,GAAGM,gBAAkB,SAASlD,GAC/B,IAAIW,EAAM9J,KAAKgM,aACf,GAAIlC,EAAK,CACR,MAAM9G,EAAU8G,EAAIpI,KAAK,mBACnByK,EAAYrC,EAAIpI,KAAK,mBACrB0K,EAAgBzL,EAAEgB,MAAMqB,GAE1BoJ,IACCA,EAAczI,aACjByI,EAAcrD,OAAOqD,EAAczI,aAAcwI,EAAWhD,GAE5DiD,EAAcrD,OAAOrC,OAAOyF,GAAYhD,GAG3C,CACD,EAEAxI,EAAEoL,GAAGO,gBAAkB,WACtB,IAAIxC,EAAM9J,KAAKgM,aACf,GAAIlC,EAAK,CACR,MAAM9G,EAAU8G,EAAIpI,KAAK,mBACnByK,EAAYrC,EAAIpI,KAAK,mBACrB0K,EAAgBzL,EAAEgB,MAAMqB,GAE1BoJ,IACCA,EAAczI,aACjByI,EAAc9D,OAAO6D,GAErBC,EAAc9D,OAAO5B,OAAOyF,IAG/B,CACD,EAIAxL,EAAE4L,UAAUC,MAAM,WACA,IAAIC,iBAAiB,SAASC,GAC9CA,EAAchM,QAAQiM,IACrB,GAAsB,cAAlBA,EAAS1H,KAAsB,CACf0H,EAASC,WACjBlM,QAAQmM,IAClB,GAAIA,EAAKC,WAAaC,KAAKC,aAAc,CAExC,GAAIH,EAAKI,aAAa,aAAc,CACnC,MAAMjK,EAAUrC,EAAEkM,GAAMnL,KAAK,aAK7B,OAJAmJ,EAAKlK,EAAEkM,SACH7J,GAAWrC,EAAEgB,MAAMqB,IACtB7B,EAAO+L,MAAM3M,KAAKI,EAAEgB,MAAMqB,IAG5B,CAAO,CAEN,MAAMmK,EAAeN,EAAKO,iBAAiB,eACvCD,EAAa7L,OAAS,GACzB6L,EAAazM,QAAQ2M,IACpB,MAAMrK,EAAUrC,EAAE0M,GAAW3L,KAAK,aAClCmJ,EAAKlK,EAAE0M,IACHrK,GAAWrC,EAAEgB,MAAMqB,IACtB7B,EAAO+L,MAAM3M,KAAKI,EAAEgB,MAAMqB,KAI9B,CACD,GAEF,GAEF,GAESsK,QAAQf,SAASgB,KAAM,CAC/BC,WAAW,EACXC,SAAS,IAIV9M,EAAE,eAAea,KAAK,SAAST,EAAKmB,GACnC,GAAwC,IAApCvB,EAAEuB,GAAOqJ,QAAQ,QAAQjK,OAAc,CAC1C,MAAM0B,EAAUrC,EAAEuB,GAAOR,KAAK,aAC9BmJ,EAAKlK,EAAEuB,IACHc,GAAWrC,EAAEgB,MAAMqB,IACtB7B,EAAO+L,MAAM3M,KAAKI,EAAEgB,MAAMqB,GAE5B,CACD,EACD,EAEA,CAl8BD,CAk8BG0K,OAAQ9M"}